# NodeJs基础

Node是MEAN架构的核心。


## 1.1 异步IO

异步相对同步而言。指的是用户线程和内核的交互方式。

- 同步。在用户线程发情IO请求之后，需要等待或者轮询内核IO操作完成之后才能继续执行。
- 异步。在用户线程发情IO请求之后，继续执行。内核IO操作完成之后通知用户线程或者调用用户现车定注册的回调函数。

## 1.2 事件驱动

传统的高并发场景，使用多线程模型：为每个业务逻辑提供一个系统线程，通过系统切换线程来弥补同步IO调用时的时间开销。

Node中使用单线程模型，对所有IO的请求都采用异步，避免频繁上下文切换。在执行的过程中会维护一个事件队列，程序在执行时会进入事件循环等待下一个事件的到来，每一个异步IO在完成之后会被推送到事件队列里，等待程序进程处理。

Node的异步机制基于事件，所有磁盘IO、网络通信，数据库查询都以非阻塞的方式请求，返回的结果由事件循环处理。Node进程在同一时刻只能处理一个事件，在完成之后立即进入事件循环检查并处理后续的事件。

Node运行原理，如下图所示:

![Node运行原理](./images/Node运行原理.jpg)

会被分为四层，分别是应用层、V8引擎层、NodeApi层、LIBUV层。

- 应用层。js交互，包括node的常用模块如http、fs等。
- V8引擎层。解析js和下层API交互。
- NodeApi。为上层模块提供系统调用，一般是C实现，会和操作系统交互。
- LIBUV层。跨平台的底层封装，实现了事件循环、文件操作，node的异步实现的核心。

这样做的好处是：CPU和内存在同一时间集中处理一件事，同时尽可能让耗时的IO操作并行执行。

## 1.3 单线程

Node只采用一个主线程接收请求，在接收到请求之后不会直接处理，而是把请求放到请求队列里，又去接收其他的请求，在空闲的时候通过EventLoop处理事件，实现异步效果。

可以这么理解：Nodejs本身是一个多线程平台，它处理js层面的任务是单线程的。

libuv是一个高性能、事件驱动的io库，提供了跨平台的api。因此nodejs的单线程仅仅指js运行在单线程中，而非node平台是单线程。

nodejs不适合cpu密集型。

## 1.4 支持微服务

原因：

- 本身跨平台
- 易于构建web服务，支持http通信
- 有从前端到后端再到后端的全栈开发能力。

## 1.5 可用性和扩展性

具备自动扩展能力的系统会自动检测到流量的增加或者减少。

- 流量增加的时候，增加服务实例
- 流量下降时，通过从服务中取回活动实例来减少服务实例的数量。

## 1.6 跨平台
